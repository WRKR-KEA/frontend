import React, { useEffect } from 'react';
import { useSSEStore } from '@/stores/sseStore';

const Toast: React.FC = () => {
  const { messages, removeMessage } = useSSEStore();
  const timers = [];

  useEffect(() => {
    if (messages.length > 0) {
      timers.push(setTimeout(() => {
        removeMessage(messages[0].id);
      }, 3000))

      return () => timers.forEach(clearTimeout);
    }
  }, [messages]);

  if (messages.length === 0) return null;

  const notificationIcon = (type: string) => {
    switch (type) {
      case "ticket": return (<svg width="48" height="48" viewBox="0 0 48 48" fill="none">
        <path d="M44 24C44 35.0457 35.0457 44 24 44C12.9543 44 4 35.0457 4 24C4 12.9543 12.9543 4 24 4C35.0457 4 44 12.9543 44 24ZM31.3205 15.8287C30.1319 15.6688 28.5614 15.6667 26.3333 15.6667H21.6667C19.4388 15.6667 17.8685 15.6691 16.68 15.8291C15.5203 15.9852 14.8746 16.2747 14.4075 16.7414C13.9408 17.2077 13.6513 17.8529 13.4953 19.0128C13.4305 19.4951 13.3916 20.0402 13.3682 20.6667H34.6315C34.6081 20.0405 34.5692 19.4955 34.5043 19.0134C34.3481 17.8537 34.0586 17.2079 33.5919 16.7408C33.1257 16.2742 32.4804 15.9847 31.3205 15.8287ZM36.6541 21.5079C36.6362 20.4509 36.5925 19.5348 36.4864 18.7465C36.3004 17.3649 35.9062 16.2274 35.0067 15.3272C34.1068 14.4265 32.9688 14.0323 31.5871 13.8465C30.2497 13.6666 28.5443 13.6666 26.4077 13.6667L26.3333 13.6667H21.6667H21.6024C19.4609 13.6666 17.7526 13.6666 16.4132 13.847C15.0316 14.033 13.8941 14.4271 12.9939 15.3266C12.0932 16.2265 11.699 17.3645 11.5132 18.7462C11.4071 19.5348 11.3636 20.4513 11.3457 21.5087C11.3376 21.5602 11.3333 21.6129 11.3333 21.6667C11.3333 21.7103 11.3361 21.7533 11.3415 21.7954C11.3333 22.4522 11.3333 23.1614 11.3333 23.9257L11.3333 24L11.3333 24.0642C11.3333 26.2058 11.3333 27.914 11.5136 29.2535C11.6996 30.6351 12.0938 31.7726 12.9933 32.6728C13.8932 33.5735 15.0312 33.9677 16.4129 34.1535C17.7503 34.3334 19.4557 34.3334 21.5923 34.3333H21.5923H21.5923H21.6667H26.3333H26.3975H26.3976C28.5391 34.3334 30.2474 34.3334 31.5868 34.153C32.9684 33.967 34.1059 33.5729 35.0061 32.6734C35.9068 31.7735 36.301 30.6355 36.4868 29.2538C36.6667 27.9163 36.6667 26.211 36.6667 24.0743V24V23.9357C36.6667 23.1678 36.6667 22.4556 36.6584 21.7961C36.6638 21.7537 36.6667 21.7105 36.6667 21.6667C36.6667 21.6126 36.6624 21.5596 36.6541 21.5079ZM34.6649 22.6667H13.3351C13.3334 23.0832 13.3333 23.5268 13.3333 24C13.3333 26.2279 13.3357 27.7982 13.4957 28.9866C13.6519 30.1463 13.9414 30.7921 14.4081 31.2592C14.8743 31.7258 15.5196 32.0153 16.6795 32.1713C17.8681 32.3312 19.4386 32.3333 21.6667 32.3333H26.3333C28.5612 32.3333 30.1315 32.3309 31.32 32.1709C32.4797 32.0148 33.1254 31.7253 33.5925 31.2586C34.0592 30.7923 34.3487 30.1471 34.5047 28.9872C34.6645 27.7986 34.6667 26.228 34.6667 24C34.6667 23.5268 34.6666 23.0832 34.6649 22.6667ZM17 27.6667C16.4477 27.6667 16 28.1144 16 28.6667C16 29.219 16.4477 29.6667 17 29.6667H21.6667C22.219 29.6667 22.6667 29.219 22.6667 28.6667C22.6667 28.1144 22.219 27.6667 21.6667 27.6667H17ZM24.5833 27.6667C24.031 27.6667 23.5833 28.1144 23.5833 28.6667C23.5833 29.219 24.031 29.6667 24.5833 29.6667H26.3333C26.8856 29.6667 27.3333 29.219 27.3333 28.6667C27.3333 28.1144 26.8856 27.6667 26.3333 27.6667H24.5833Z"
              fill-rule="evenodd" fill="var(--main-1)" />
      </svg>);
      case "comment": return (<svg width="48" height="48" viewBox="0 0 48 48" fill="none">
        <path d="M44 24C44 35.0457 35.0457 44 24 44C12.9543 44 4 35.0457 4 24C4 12.9543 12.9543 4 24 4C35.0457 4 44 12.9543 44 24ZM11.3333 24C11.3333 17.0042 17.0042 11.3333 24 11.3333C30.9958 11.3333 36.6667 17.0042 36.6667 24C36.6667 30.9954 30.9965 36.666 24.0013 36.6667L24 35.6667V36.6667C22.043 36.669 20.1122 36.2161 18.3603 35.3438L18.3531 35.3403L18.346 35.3366C18.152 35.2361 17.9281 35.2095 17.716 35.2616L17.7241 35.2595L17.4655 34.2935L17.7105 35.263L17.716 35.2616L15.1271 35.9548L15.1263 35.955C14.6998 36.0688 14.2508 36.0685 13.8245 35.9539C13.3981 35.8394 13.0094 35.6147 12.6974 35.3024C12.3853 34.9902 12.1609 34.6013 12.0466 34.1749C11.9323 33.7486 11.9322 33.2997 12.0463 32.8733L13.0123 33.1315L12.0463 32.8731L12.7404 30.2763L12.7405 30.2761C12.7895 30.0929 12.7688 29.8685 12.6557 29.6424L12.6548 29.6405C11.8095 27.9411 11.3333 26.025 11.3333 24ZM24 13.3333C18.1088 13.3333 13.3333 18.1088 13.3333 24C13.3333 25.7081 13.7344 27.3198 14.4452 28.7492L14.4446 28.748L13.5502 29.1952L14.4455 28.7498L14.4452 28.7492C14.747 29.3535 14.8637 30.0782 14.6726 30.7927L14.6725 30.7929L13.9784 33.3897L13.9784 33.3899C13.9549 33.4775 13.955 33.5696 13.9784 33.6572C14.0019 33.7447 14.048 33.8246 14.112 33.8887C14.1761 33.9528 14.2559 33.9989 14.3434 34.0224C14.4308 34.0459 14.5228 34.046 14.6102 34.0228L14.6107 34.0226L17.2069 33.3275L17.2205 33.3239L17.2206 33.324C17.9054 33.1509 18.6298 33.2337 19.2578 33.5565C20.7308 34.2887 22.3537 34.6688 23.9987 34.6667H24C29.8912 34.6667 34.6667 29.8912 34.6667 24C34.6667 18.1088 29.8912 13.3333 24 13.3333ZM19.3333 21.25C18.781 21.25 18.3333 21.6977 18.3333 22.25C18.3333 22.8023 18.781 23.25 19.3333 23.25H28.6667C29.219 23.25 29.6667 22.8023 29.6667 22.25C29.6667 21.6977 29.219 21.25 28.6667 21.25H19.3333ZM19.3333 25.3333C18.781 25.3333 18.3333 25.781 18.3333 26.3333C18.3333 26.8856 18.781 27.3333 19.3333 27.3333H25.75C26.3023 27.3333 26.75 26.8856 26.75 26.3333C26.75 25.781 26.3023 25.3333 25.75 25.3333H19.3333Z"
              fill-rule="evenodd" fill="var(--in-progress)" />
      </svg>);
      case "remind": return (<svg width="48" height="48" viewBox="0 0 48 48" fill="none">
        <path d="M44 24C44 35.0457 35.0457 44 24 44C12.9543 44 4 35.0457 4 24C4 12.9543 12.9543 4 24 4C35.0457 4 44 12.9543 44 24ZM24 13.3333C18.109 13.3333 13.3333 18.109 13.3333 24C13.3333 29.891 18.109 34.6667 24 34.6667C29.891 34.6667 34.6667 29.891 34.6667 24C34.6667 18.109 29.891 13.3333 24 13.3333ZM11.3333 24C11.3333 17.0044 17.0044 11.3333 24 11.3333C30.9956 11.3333 36.6667 17.0044 36.6667 24C36.6667 30.9956 30.9956 36.6667 24 36.6667C17.0044 36.6667 11.3333 30.9956 11.3333 24ZM25 17C25 16.4477 24.5523 16 24 16C23.4477 16 23 16.4477 23 17V24C23 24.3788 23.214 24.725 23.5528 24.8944L28.2195 27.2278C28.7134 27.4748 29.3141 27.2745 29.5611 26.7805C29.8081 26.2866 29.6079 25.6859 29.1139 25.4389L25 23.382V17Z"
              fill-rule="evenodd" fill="var(--request)" />
      </svg>);
      default: return (<svg width="48" height="48" viewBox="0 0 48 48" fill="none">
          <path d="M44 24C44 35.046 35.046 44 24 44C12.954 44 4 35.046 4 24C4 12.954 12.954 4 24 4C35.046 4 44 12.954 44 24ZM24 35.5C24.3978 35.5 24.7794 35.342 25.0607 35.0607C25.342 34.7794 25.5 34.3978 25.5 34V22C25.5 21.6022 25.342 21.2206 25.0607 20.9393C24.7794 20.658 24.3978 20.5 24 20.5C23.6022 20.5 23.2206 20.658 22.9393 20.9393C22.658 21.2206 22.5 21.6022 22.5 22V34C22.5 34.828 23.172 35.5 24 35.5ZM24 14C24.5304 14 25.0391 14.2107 25.4142 14.5858C25.7893 14.9609 26 15.4696 26 16C26 16.5304 25.7893 17.0391 25.4142 17.4142C25.0391 17.7893 24.5304 18 24 18C23.4696 18 22.9609 17.7893 22.5858 17.4142C22.2107 17.0391 22 16.5304 22 16C22 15.4696 22.2107 14.9609 22.5858 14.5858C22.9609 14.2107 23.4696 14 24 14Z"
                fill-rule="evenodd" fill="var(--in-progress)" />
        </svg>
      )
    }
  }

  const notificationBgColor = (type: string) => {
    switch (type) {
      case "ticket":
        return "bg-main-3";
      case "comment":
        return "bg-inProgress";
      case "remind":
        return "bg-request";
      default:
        return "bg-inProgress";
    }
  }

  return (
    <ul className="fixed flex flex-col gap-y-2 top-5 right-5 w-fit h-fit z-50">
      {messages.map(({ message, type }, index) => (
        <li key={index}>
          <div
            className={`flex items-center whitespace-pre-wrap w-[480px] h-20 text-black p-4 gap-4 rounded-md shadow-md ${notificationBgColor(type)}`}>
            {notificationIcon(type)}
            {message}
          </div>
        </li>
      ))}
    </ul>
  );
};

export default Toast;